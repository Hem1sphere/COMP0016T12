{% extends 'main/base.html' %}
{% load crispy_forms_tags %}
{% load template_methods %}

{% block content %}
    <div class="card">
        <div class="card-body row">
            <div class="col-md-6">
                <h1>{{ object.title }}</h1>
                <p class="lead">Created by <a href="
                {% if user == object.clinician.user %}
                    {% url 'profile' %}
                {% else %}
                    {% url 'specific_profile' object.clinician %}
                {% endif %}">{{ object.clinician }}</a> on {{ object.date_created|date:"d F, Y" }}
                </p>
            </div>
            <div class="col-md-3"></div>
            <div class="col-md-3">
                <h4>Prize Money: £{{ object.award }}</h4>
                {% if user.is_developer %}
                    {% user_is_in_challenge object.pk user.developer.pk as userParticipation %}
                    <form action="#" method="POST">
                        {% if userParticipation %}
                            <a class="btn btn-danger btn-lg" href="{% url 'leave' object.id %}" role="button">Leave
                                Challenge</a>
                        {% else %}
                            <a class="btn btn-primary btn-lg" href="{% url 'participate' object.id %}" role="button">Participate</a>
                        {% endif %}
                    </form>
                {% endif %}
            </div>
        </div>
    </div>



    <div class="container" style="margin-top: 2rem; padding-left: 0;">

        <ul class="nav nav-tabs">
            <li class="nav-item"><a data-toggle="tab" class="nav-link show active" href="#description">Description</a>
            </li>
            <li class="nav-item"><a data-toggle="tab" class="nav-link show" href="#evaluation">Evaluation</a></li>
            <li class="nav-item"><a data-toggle="tab" class="nav-link show" href="#prize">Prize</a></li>
            <li class="nav-item"><a data-toggle="tab" class="nav-link show" href="#timeline">Timeline</a></li>
        </ul>


        <div id="challengeTabContent" class="tab-content" style="padding-top: 1rem">

            <div id="description" class="tab-pane fade show active">
                {{ object.description }}
                <div class="container" style="margin-top: 2rem; padding-left: 0">
                    {% if object.data.url != null %}
                        {% if user.is_admin or user.is_clinician %}
                            <a class="btn btn-primary" href="{{ object.data.url }}" download>Download Data</a>
                        {% endif %}
                    {% endif %}
                </div>
            </div>

            <div id="evaluation" class="tab-pane fade">
                <h3>To be added</h3>
            </div>

            <div id="prize" class="tab-pane fade">
                <h6>The prize money for this particular challenge will be £{{ object.award }}.</h6>
                <h6>The recipient for the prize will be informed via
                    <email></email>
                    .
                </h6>
            </div>

            <div id="timeline" class="tab-pane fade">
                <h3>To be added</h3>
            </div>


        </div>
    </div>

    {% if object.clinician == user.clinician %}
        <div>
            <a class="btn btn-secondary btn-sm mt-1 mb-1" href="{% url 'challenges_update' object.id %}">Update</a>
            <a class="btn btn-danger btn-sm mt-1 mb-1" href="{% url 'challenges_delete' object.id %}">Delete</a>
        </div>
    {% endif %}



    <hr class="my-4">

    <div>
        {% if userParticipation %}
            <a class="btn btn-info btn-lg" href="http://51.140.115.12/hub/user/{{ user.username }}/lab"
               target="_blank"
               role="button">To Jupyter Notebook</a>
            <a class="btn btn-primary btn-lg" href="{% url 'solutions_create_spec' object.pk %}"
               role="button">Submit Solution</a>

             <hr class="my-4">
        {% endif %}
    
    </div>



    <script>$(document).ready(function () {
        $('#example').DataTable();
    });</script>

    <table id="example" class="table table-striped table-bordered" style="width:100%">
        <thead>
            <tr>
                <th>Solution</th>
                <th>Date Created</th>
                <th>Accuracy</th>
            </tr>
        </thead>
        <tbody>

        {% for solution in challenge.solution_set.all %}
            <tr>
                <td><a
                        href="{% url 'solutions_detail' solution.id %}">{{ solution.title }}</a> by <a href="
                    {% if user == solution.developer.user %}
                        {% url 'profile' %}
                    {% else %}
                        {% url 'specific_profile' solution.developer %}
                    {% endif %}">{{ solution.developer }}</a>

                </td>
                <td>{{ solution.date_created }}</td>
                <td>{{ solution.accuracy }}%</td>
            </tr>
        {% endfor %}

        </tbody>

    </table>











    {#        {% endfor %}#}
    {#        </table>#}


    {#    </div>#}
{% endblock %}